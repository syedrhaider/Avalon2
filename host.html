<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avalon - Host Game</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Georgia',serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);min-height:100vh;color:#f0f0f0;padding:20px}
.host-container{max-width:1000px;margin:0 auto;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2)}
.title{font-size:2.5rem;text-align:center;color:#ffd700;margin-bottom:30px;text-shadow:2px 2px 4px rgba(0,0,0,.7)}
.form-section{margin-bottom:25px;background:rgba(255,255,255,.05);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,.1)}
.form-group{margin-bottom:15px}
label{display:block;margin-bottom:5px;color:#ffd700;font-weight:bold}
input[type="text"],input[type="number"]{width:100%;padding:10px;border:1px solid rgba(255,255,255,.3);border-radius:8px;background:rgba(255,255,255,.1);color:white;font-size:16px}
input[type="text"]::placeholder,input[type="number"]::placeholder{color:rgba(255,255,255,.6)}
.quest-setup{display:none}
.quest-round{display:flex;align-items:center;gap:15px;margin-bottom:10px;flex-wrap:wrap}
.character-section{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px}
.character-toggle{display:flex;align-items:center;gap:10px;padding:10px;background:rgba(255,255,255,.1);border-radius:8px;cursor:pointer;transition:all .3s ease}
.character-toggle:hover{background:rgba(255,255,255,.2)}
.character-toggle.active{background:rgba(78,205,196,.3);border:2px solid #4ecdc4}
.character-toggle.inactive{background:rgba(255,107,107,.3);border:2px solid #ff6b6b}
.character-toggle.disabled{opacity:.5;cursor:not-allowed;background:rgba(128,128,128,.2)}
.toggle-switch{width:50px;height:25px;background:#ccc;border-radius:15px;position:relative;cursor:pointer;transition:background .3s}
.toggle-switch.active{background:#4ecdc4}
.toggle-slider{width:21px;height:21px;background:white;border-radius:50%;position:absolute;top:2px;left:2px;transition:transform .3s}
.toggle-switch.active .toggle-slider{transform:translateX(25px)}
.action-buttons{display:flex;gap:15px;margin-top:30px;flex-wrap:wrap}
.btn{padding:12px 25px;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;transition:all .3s ease}
.btn-primary{background:linear-gradient(45deg,#4ecdc4,#44a08d);color:white}
.btn-primary:hover{background:linear-gradient(45deg,#45b7b8,#3d9970);transform:translateY(-2px)}
.btn-secondary{background:linear-gradient(45deg,#ff6b6b,#ee5a6f);color:white}
.btn-secondary:hover{background:linear-gradient(45deg,#ff5252,#e53e3e);transform:translateY(-2px)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.room-info{background:rgba(255,215,0,.1);border:2px solid #ffd700;border-radius:12px;padding:20px;margin-top:20px;text-align:center}
.room-code{font-size:2rem;font-weight:bold;color:#ffd700;margin-bottom:10px}
.players-list{margin-top:20px}
.player-item{background:rgba(255,255,255,.1);padding:10px;margin:5px 0;border-radius:8px;display:flex;justify-content:space-between;align-items:center;cursor:grab}
.player-item:active{cursor:grabbing}
.player-item.dragging{opacity:.5}
.player-item.online{border-left:4px solid #4ecdc4}
.player-item.offline{border-left:4px solid #ff6b6b;opacity:.7}
.connection-status{font-size:12px;padding:4px 8px;border-radius:4px}
.status-online{background:rgba(78,205,196,.3);color:#4ecdc4}
.status-offline{background:rgba(255,107,107,.3);color:#ff6b6b}
.error-message{background:rgba(255,107,107,.2);border:2px solid #ff6b6b;border-radius:8px;padding:15px;margin-top:15px;color:#ffcccb;display:none}
.error-message.show{display:block}
.loading{opacity:.6;pointer-events:none}
.hidden{display:none}
@media(max-width:768px){.host-container{padding:20px}.title{font-size:2rem}.character-section{grid-template-columns:1fr}.quest-round{flex-direction:column;align-items:stretch}}
</style>
</head>
<body>
<div class="host-container">
<h1 class="title">Host Avalon Game</h1>
<div class="form-section">
<div class="form-group"><label for="hostName">Host's Name:</label><input type="text" id="hostName" placeholder="Enter your name" maxlength="20"></div>
<div class="form-group"><label for="totalQuests">Total Number of Quests (must be odd):</label><input type="number" id="totalQuests" min="3" max="7" step="2" value="5"></div>
<div class="quest-setup" id="questSetup"><h3 style="color:#ffd700;margin-bottom:15px;">Quest Configuration</h3><div id="questRounds"></div></div>
<div class="form-group"><label for="totalPlayers">Total Number of Players:</label><input type="number" id="totalPlayers" min="5" max="10" value="5"></div>
</div>
<div class="form-section">
<div class="form-group"><label for="goodPlayers">Number of Good Players:</label><input type="number" id="goodPlayers" min="2" max="6" readonly></div>
<h4 style="color:#4ecdc4;margin-bottom:10px;">Good Characters</h4>
<div class="character-section" id="goodCharacters">
<div class="character-toggle" data-character="merlin"><div class="toggle-switch" onclick="toggleCharacter(this,'merlin')"><div class="toggle-slider"></div></div><span>Merlin</span></div>
<div class="character-toggle" data-character="percival"><div class="toggle-switch" onclick="toggleCharacter(this,'percival')"><div class="toggle-slider"></div></div><span>Percival</span></div>
</div>
<div id="loyalServants"></div>
</div>
<div class="form-section">
<div class="form-group"><label for="evilPlayers">Number of Evil Players:</label><input type="number" id="evilPlayers" min="2" max="4" readonly></div>
<h4 style="color:#ff6b6b;margin-bottom:10px;">Evil Characters</h4>
<div class="character-section" id="evilCharacters">
<div class="character-toggle" data-character="assassin"><div class="toggle-switch" onclick="toggleCharacter(this,'assassin')"><div class="toggle-slider"></div></div><span>Assassin</span></div>
<div class="character-toggle" data-character="mordred"><div class="toggle-switch" onclick="toggleCharacter(this,'mordred')"><div class="toggle-slider"></div></div><span>Mordred</span></div>
<div class="character-toggle" data-character="morgana"><div class="toggle-switch" onclick="toggleCharacter(this,'morgana')"><div class="toggle-slider"></div></div><span>Morgana</span></div>
<div class="character-toggle" data-character="oberon"><div class="toggle-switch" onclick="toggleCharacter(this,'oberon')"><div class="toggle-slider"></div></div><span>Oberon</span></div>
</div>
<div id="evilMinions"></div>
</div>
<div class="action-buttons"><button class="btn btn-primary" id="createRoomBtn" onclick="createRoom()">Create Room</button></div>
<div class="error-message" id="errorMessage"></div>
<div class="room-info hidden" id="roomInfo">
<div class="room-code" id="roomCode">Room Code: XXXX</div>
<div>Players Joined: <span id="playersJoined">0</span>/<span id="totalPlayersSpan">5</span></div>
<div class="players-list"><h4 style="color:#ffd700;margin-bottom:10px;">Player Order (Drag to Rearrange)</h4><div id="playersList"></div></div>
<div class="action-buttons"><button class="btn btn-secondary hidden" id="startGameBtn" onclick="startGame()">Start Game</button></div>
</div>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, get, onValue, onDisconnect, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
const firebaseConfig = {apiKey:"AIzaSyC2ftCc15TGgU7xZA6w0lk91Zh_BGrq-Nw",authDomain:"avalongame2-cce7d.firebaseapp.com",databaseURL:"https://avalongame2-cce7d-default-rtdb.firebaseio.com",projectId:"avalongame2-cce7d",storageBucket:"avalongame2-cce7d.firebasestorage.app",messagingSenderId:"38095531354",appId:"1:38095531354:web:c29837d5c9fea651ac5763",measurementId:"G-BQBEPTC8YE"};
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);
window.firebase={database,auth,ref,set,get,onValue,onDisconnect,serverTimestamp,signInAnonymously};
let gameState={hostName:'',totalQuests:5,questConfig:[],totalPlayers:5,goodPlayers:3,evilPlayers:2,characters:{merlin:false,percival:false,assassin:false,mordred:false,morgana:false,oberon:false},roomCode:'',players:{},playerOrder:[]};
const playerDistribution={5:{good:3,evil:2},6:{good:4,evil:2},7:{good:4,evil:3},8:{good:5,evil:3},9:{good:6,evil:3},10:{good:6,evil:4}};
let currentUser=null,roomRef=null,playersRef=null;
async function initFirebase(){try{const u=await firebase.signInAnonymously(firebase.auth);currentUser=u.user}catch(e){console.error(e);showError('Failed to connect to Firebase. Please refresh the page.')}}
document.getElementById('totalQuests').addEventListener('change',updateQuestSetup);
document.getElementById('totalPlayers').addEventListener('change',updatePlayerDistribution);
function updateQuestSetup(){const t=parseInt(document.getElementById('totalQuests').value);if(t%2===0){document.getElementById('totalQuests').value=t+1;return;}const q=document.getElementById('questSetup');const r=document.getElementById('questRounds');q.style.display='block';r.innerHTML='';gameState.questConfig=[];for(let i=1;i<=t;i++){const d=document.createElement('div');d.className='quest-round';d.innerHTML=`<label>Quest ${i}:</label><input type="number" placeholder="Players needed" min="2" max="5" value="2" onchange="updateQuestConfig(${i-1},'players',this.value)"><input type="number" placeholder="Rejects needed to fail" min="1" max="3" value="1" onchange="updateQuestConfig(${i-1},'rejects',this.value)">`;r.appendChild(d);gameState.questConfig.push({players:2,rejects:1});}}
function updateQuestConfig(i,p,v){gameState.questConfig[i][p]=parseInt(v);}
function updatePlayerDistribution(){const t=parseInt(document.getElementById('totalPlayers').value);const d=playerDistribution[t];document.getElementById('goodPlayers').value=d.good;document.getElementById('evilPlayers').value=d.evil;document.getElementById('totalPlayersSpan').textContent=t;gameState.totalPlayers=t;gameState.goodPlayers=d.good;gameState.evilPlayers=d.evil;enforceCharacterLimits();updateCharacterCounts();}
function enforceCharacterLimits(){const maxGood=gameState.goodPlayers;const maxEvil=gameState.evilPlayers;const goodChars=['merlin','percival'];const evilChars=['assassin','mordred','morgana','oberon'];let selectedGood=goodChars.filter(c=>gameState.characters[c]).length;if(selectedGood>maxGood)goodChars.forEach(c=>gameState.characters[c]=false);let selectedEvil=evilChars.filter(c=>gameState.characters[c]).length;if(selectedEvil>maxEvil)evilChars.forEach(c=>gameState.characters[c]=false);}
function toggleCharacter(el,c){const t=el.classList.contains('active');const p=el.parentElement;if(t){el.classList.remove('active');p.classList.remove('active');p.classList.add('inactive');gameState.characters[c]=false;}else{const goodChars=['merlin','percival'];const evilChars=['assassin','mordred','morgana','oberon'];if(goodChars.includes(c)){if(goodChars.filter(ch=>gameState.characters[ch]).length>=gameState.goodPlayers)return;}if(evilChars.includes(c)){if(evilChars.filter(ch=>gameState.characters[ch]).length>=gameState.evilPlayers)return;}el.classList.add('active');p.classList.remove('inactive');p.classList.add('active');gameState.characters[c]=true;}updateCharacterCounts();}
function updateCharacterCounts(){updateLoyalServants();updateEvilMinions();}
function updateLoyalServants(){const s=['merlin','percival'].filter(c=>gameState.characters[c]).length;const l=gameState.goodPlayers-s;const c=document.getElementById('loyalServants');c.innerHTML='';for(let i=0;i<l;i++){const d=document.createElement('div');d.className='character-toggle disabled';d.innerHTML=`<div class="toggle-switch"><div class="toggle-slider"></div></div><span>Loyal Servant of Arthur ${i+1}</span>`;c.appendChild(d);}}
function updateEvilMinions(){const s=['assassin','mordred','morgana','oberon'].filter(c=>gameState.characters[c]).length;const l=gameState.evilPlayers-s;const c=document.getElementById('evilMinions');c.innerHTML='';for(let i=0;i<l;i++){const d=document.createElement('div');d.className='character-toggle disabled';d.innerHTML=`<div class="toggle-switch"><div class="toggle-slider"></div></div><span>Minion of Mordred ${i+1}</span>`;c.appendChild(d);}}
function showError(msg){const e=document.getElementById('errorMessage');e.textContent=msg;e.classList.add('show');setTimeout(()=>{e.classList.remove('show')},5000);}
async function createRoom(){const hostName=document.getElementById('hostName').value.trim();if(!hostName){showError('Please enter your name');return;}gameState.hostName=hostName;const roomCode=Math.random().toString(36).substring(2,6).toUpperCase();gameState.roomCode=roomCode;roomRef=ref(database,'rooms/'+roomCode);playersRef=ref(database,'rooms/'+roomCode+'/players');await set(roomRef,{host:hostName,createdAt:serverTimestamp(),totalPlayers:gameState.totalPlayers,goodPlayers:gameState.goodPlayers,evilPlayers:gameState.evilPlayers,questConfig:gameState.questConfig,characters:gameState.characters,playerOrder:[]});const pRef=ref(database,'rooms/'+roomCode+'/players/'+currentUser.uid);await set(pRef,{name:hostName,joinedAt:serverTimestamp(),online:true});onDisconnect(pRef).update({online:false});document.getElementById('roomInfo').classList.remove('hidden');document.getElementById('roomCode').textContent='Room Code: '+roomCode;listenPlayers();}
function listenPlayers(){onValue(playersRef,(snapshot)=>{const data=snapshot.val()||{};const list=document.getElementById('playersList');list.innerHTML='';let count=0;for(const uid in data){count++;const p=data[uid];const div=document.createElement('div');div.className='player-item '+(p.online?'online':'offline');div.textContent=p.name;list.appendChild(div);}document.getElementById('playersJoined').textContent=count;if(count>=gameState.totalPlayers)document.getElementById('startGameBtn').classList.remove('hidden');});}
function startGame(){alert('Game starting! Implement game logic here.');}
initFirebase();
updateQuestSetup();
updatePlayerDistribution();
</script>
</body>
</html>
